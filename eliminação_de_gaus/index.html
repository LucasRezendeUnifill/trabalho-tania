<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Eliminação Gaussiana</title>
  <style>
    body{font-family:Arial, sans-serif;margin:20px}
    h1{text-align:center}
    label{font-weight:bold}
    select,button{margin:10px 0}
    table{margin-top:20px;border-collapse:collapse;width:100%;max-width:720px}
    table,th,td{border:1px solid #000}
    th,td{padding:8px;text-align:center}
    input{width:70px;text-align:center}
    .result{margin-top:20px;max-width:720px}
    .steps{white-space:pre-wrap;background:#f7f7f7;border:1px solid #ddd;padding:10px;border-radius:6px}
    .row-flex{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
    .muted{color:#666;font-size:0.9rem}
  </style>
</head>
<body>
  <h1>Eliminação Gaussiana - Resolução de Sistemas Lineares</h1>

  <div class="row-flex">
    <div>
      <label for="size">Escolha o tamanho da matriz:</label><br/>
      <select id="size">
        <option value="2">2x2</option>
        <option value="3" selected>3x3</option>
        <option value="4">4x4</option>
        <option value="5">5x5</option>
      </select>
    </div>
    <button id="fillExample" type="button">Exemplo</button>
  </div>

  <div id="matrixInputs"></div>

  <button id="solveBtn" type="button">Resolver Sistema (Primeiro Passo)</button>

  <div class="result">
    <h3>Resultado:</h3>
    <p id="output" class="muted">Soluções aparecerão aqui...</p>
    <h4>Passo-a-passo:</h4>
    <div id="steps" class="steps"></div>
  </div>

  <script>
    const sizeSelect = document.getElementById('size');
    const matrixDiv  = document.getElementById('matrixInputs');
    const solveBtn   = document.getElementById('solveBtn');
    const outputEl   = document.getElementById('output');
    const stepsEl    = document.getElementById('steps');
    const exampleBtn = document.getElementById('fillExample');
    const EPS = 1e-10;

    function buildMatrixInputs(n){
      let table = '<table><thead><tr>';
      for(let j=0;j<n;j++) table += `<th>a${j+1}</th>`;
      table += '<th>b</th></tr></thead><tbody>';
      for(let i=0;i<n;i++){
        table += '<tr>';
        for(let j=0;j<n;j++){
          table += `<td><input type="number" step="any" id="a_${i}_${j}" placeholder="a${i+1}${j+1}"></td>`;
        }
        table += `<td><input type="number" step="any" id="b_${i}" placeholder="b${i+1}"></td></tr>`;
      }
      table += '</tbody></table>';
      matrixDiv.innerHTML = table;
      outputEl.textContent = 'Soluções aparecerão aqui...';
      stepsEl.textContent = '';
    }

    function readAugmentedMatrix(n){
      const A = Array.from({length:n}, ()=>Array(n).fill(0));
      const b = Array(n).fill(0);
      for(let i=0;i<n;i++){
        for(let j=0;j<n;j++){
          A[i][j] = parseFloat(document.getElementById(`a_${i}_${j}`).value || '0');
        }
        b[i] = parseFloat(document.getElementById(`b_${i}`).value || '0');
      }
      return {A,b};
    }

    function formatMatrix(A, b){
      const fmt = x => Math.abs(x) < EPS ? '0' : Number(x).toFixed(3).replace(/\.?0+$/,'');
      let s = '';
      for(let i=0;i<A.length;i++){
        s += '[ ' + A[i].map(fmt).join('\t') + ' | ' + fmt(b[i]) + ' ]\n';
      }
      return s;
    }

    function gaussianFirstStep(Ain, bin){
      const n = Ain.length;
      const A = Ain.map(row => row.slice());
      const b = bin.slice();
      let steps = 'Matriz aumentada inicial (A|b):\n' + formatMatrix(A,b) + '\n';

      let k = 0; 
      let pivotRow = k;
      let maxAbs = Math.abs(A[k][k]);
      for(let i=k+1;i<n;i++){
        const val = Math.abs(A[i][k]);
        if(val > maxAbs){ maxAbs = val; pivotRow = i; }
      }
      if(pivotRow !== k){
        [A[k], A[pivotRow]] = [A[pivotRow], A[k]];
        [b[k], b[pivotRow]] = [b[pivotRow], b[k]];
        steps += `Troca L${k+1} ↔ L${pivotRow+1}\n` + formatMatrix(A,b) + '\n';
      }

      for(let i=k+1;i<n;i++){
        const factor = Math.abs(A[k][k]) < EPS ? 0 : A[i][k] / A[k][k];
        if(Math.abs(factor) < EPS) continue;
        for(let j=k;j<n;j++) A[i][j] -= factor * A[k][j];
        b[i] -= factor * b[k];
        steps += `L${i+1} = L${i+1} - (${factor.toFixed(3)})·L${k+1}\n` + formatMatrix(A,b) + '\n';
      }

      return {steps};
    }

    function solve(){
      const n = parseInt(sizeSelect.value,10);
      const {A,b} = readAugmentedMatrix(n);
      const res = gaussianFirstStep(A,b);
      outputEl.textContent = 'Primeiro passo realizado.';
      stepsEl.textContent = res.steps;
    }

    function fillExample(){
      const n = parseInt(sizeSelect.value,10);
      const examples = {
        2: {A:[[2,1],[5,7]], b:[11,13]},
        3: {A:[[2,1,-1],[-3,-1,2],[-2,1,2]], b:[8,-11,-3]},
        4: {A:[[1,2,3,4],[2,1,-1,2],[3,-1,2,1],[4,2,1,3]], b:[20,3,10,17]}
      };
      const {A,b} = examples[n];
      for(let i=0;i<n;i++){
        for(let j=0;j<n;j++){
          document.getElementById(`a_${i}_${j}`).value = A[i][j];
        }
        document.getElementById(`b_${i}`).value = b[i];
      }
      outputEl.textContent = 'Exemplo preenchido.';
      stepsEl.textContent = '';
    }

    sizeSelect.addEventListener('change', ()=> buildMatrixInputs(parseInt(sizeSelect.value,10)));
    solveBtn.addEventListener('click', solve);
    exampleBtn.addEventListener('click', fillExample);
    buildMatrixInputs(parseInt(sizeSelect.value,10));
  </script>
</body>
</html>
